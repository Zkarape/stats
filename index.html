<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‘±÷Ä’ø’°’§÷Ä’∏’≤’°’Ø’°’∂’∏÷Ç’©’µ’°’∂ ’æ’°’∞’°’∂’°’Ø</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --border: #e2e8f0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --accent: #6366f1;
      --trust-blue: #0ea5e9;
    }
    .login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .login-screen.hidden { display: none; }
    .login-box { background: white; padding: 3rem 2.5rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); text-align: center; max-width: 400px; width: 90%; animation: slideIn 0.4s ease; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    .login-logo { width: 220px; height: auto; margin-bottom: 2rem; object-fit: contain; }
    .login-title { font-size: 1.5rem; font-weight: 700; color: var(--text); margin-bottom: 0.5rem; }
    .login-subtitle { font-size: 0.95rem; color: #64748b; margin-bottom: 2rem; }
    .login-input { width: 100%; padding: 0.9rem 1.2rem; padding-right: 3rem; border: 2px solid var(--border); border-radius: 10px; font-size: 1rem; transition: all 0.3s; }
    .password-wrapper { position: relative; width: 100%; margin-bottom: 1.5rem; }
    .password-toggle { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem; color: #64748b; padding: 0.5rem; transition: color 0.2s; }
    .password-toggle:hover { color: var(--primary); }
    .login-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    .login-input.error { border-color: var(--danger); animation: shake 0.4s; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    .login-btn { width: 100%; padding: 0.9rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1.05rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
    .login-error { color: var(--danger); font-size: 0.9rem; margin-bottom: 1rem; display: none; }
    .login-error.visible { display: block; }
    .main-content { display: none; }
    .main-content.visible { display: block; }
    * { box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 1rem; }
    .container { max-width: 1200px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 2rem; }
    h1 { color: var(--primary); font-size: 2rem; margin: 0 0 0.5rem; }
    .subtitle { color: #64748b; font-size: 1rem; }
    .controls { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center; align-items: center; }
    select, button { padding: 0.65rem 1.2rem; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; transition: 0.2s; }
    select { min-width: 200px; background: white; }
    button { background: var(--primary); color: white; font-weight: 600; cursor: pointer; box-shadow: var(--shadow); }
    button:hover { background: #2563eb; transform: translateY(-1px); }
    .dictation-btn { background: var(--danger); }
    .dictation-btn:hover { background: #dc2626; }
    .dept-card { background: var(--card); border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 1.5rem; cursor: pointer; transition: 0.2s; }
    .dept-card:hover { transform: translateY(-2px); }
    .dept-header { display: flex; justify-content: space-between; align-items: center; }
    .dept-name { font-weight: 700; font-size: 1.3rem; color: var(--primary); }
    .dept-toggle { font-size: 1.2rem; color: var(--accent); }
    .dept-metric { font-size: 1.6rem; font-weight: 800; margin: 0.5rem 0; }
    .dept-subtext { font-size: 0.9rem; color: #64748b; }
    .savings-info { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 2px solid var(--success); border-radius: 10px; padding: 1rem 1.25rem; margin-top: 1rem; }
    .savings-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
    .savings-icon { font-size: 1.5rem; }
    .savings-title { font-weight: 700; font-size: 1.1rem; color: var(--success); }
    .savings-comparison { display: flex; gap: 1rem; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(16, 185, 129, 0.2); }
    .comparison-item { flex: 1; }
    .comparison-label { font-size: 0.75rem; color: #065f46; font-weight: 600; text-transform: uppercase; margin-bottom: 0.25rem; }
    .comparison-value { font-size: 1.1rem; font-weight: 700; }
    .comparison-value.after { color: var(--success); }
    .comparison-value.before { color: var(--danger); }
    .users-container { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); display: none; }
    .users-container.open { display: block; }
    .user-list { margin-bottom: 1.5rem; }
    .user-item { background: #f0fdf4; border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 0.5rem; border: 1px solid #86efac; display: flex; justify-content: space-between; align-items: center; }
    .user-name { font-weight: 600; color: var(--text); }
    .user-metric { font-weight: 700; font-size: 1rem; }
    .user-savings { color: var(--trust-blue); font-size: 0.9rem; font-weight: 600; margin-left: 0.5rem; }
    .chart-container { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow); margin: 1.5rem 0; border: 1px solid var(--border); }
    .loading, .error { text-align: center; padding: 2rem; border-radius: 12px; margin: 1rem 0; }
    .loading { color: #64748b; background: #f8fafc; }
    .error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
    .footer { text-align: center; color: #94a3b8; font-size: 0.85rem; margin-top: 3rem; }
    .hidden { display: none !important; }
    .dictation-dept { background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid var(--success); }
  </style>
</head>
<body>
  <div id="loginScreen" class="login-screen">
    <div class="login-box">
      <img src="erebuni.png" alt="‘∑÷Ä’•’¢’∏÷Ç’∂’´ ’¢’™’∑’Ø’°’Ø’°’∂ ’Ø’•’∂’ø÷Ä’∏’∂" class="login-logo">
      <h2 class="login-title">‘±÷Ä’ø’°’§÷Ä’∏’≤’°’Ø’°’∂’∏÷Ç’©’µ’°’∂ ’æ’°’∞’°’∂’°’Ø</h2>
      <p class="login-subtitle">’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’•÷Ñ ’£’°’≤’ø’∂’°’¢’°’º’®</p>
      <div class="login-error" id="loginError">’ç’≠’°’¨ ’£’°’≤’ø’∂’°’¢’°’º</div>
      <div class="password-wrapper">
        <input type="password" id="passwordInput" class="login-input" placeholder="‘≥’°’≤’ø’∂’°’¢’°’º" autocomplete="off">
        <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">Eye</button>
      </div>
      <button class="login-btn" onclick="handleLogin()">’Ñ’∏÷Ç’ø÷Ñ</button>
    </div>
  </div>

  <div id="mainContent" class="main-content">
    <div class="container">
      <header>
        <h1>‘¥’´’Ø’ø’°÷Å’´’°’µ’´ ’æ’°’∞’°’∂’°’Ø üé§</h1>
        <p class="subtitle">MRT ÷á CT ’¢’°’™’´’∂’∂’•÷Ä ‚Ä¢ 3√ó ’°’æ’•’¨’´ ’°÷Ä’°’£ ÷Ñ’°’∂ ’ø’∫’°’£÷Ä’∏÷Ç’¥’®</p>
      </header>

      <div class="controls">
        <button onclick="loadData()">‘π’°÷Ä’¥’°÷Å’∂’•’¨</button>
      </div>

      <div id="loading" class="loading">‘≤’•’º’∂’æ’∏÷Ç’¥ ’ß...</div>
      <div id="error" class="error" style="display:none;"></div>

      <!-- MRT & CT Dictation Blocks -->
      <div id="dictationDepartments"></div>

      <!-- Other Departments -->
      <div id="otherDepartments"></div>

      <div class="footer">
        1 ’™’°’¥ ’≠’∂’°’µ’æ’∏÷Ç’¥ ’ß 60,000 ’∂’´’∑’´ ’∞’°’¥’°÷Ä ‚Ä¢ ’è’∫’°’£÷Ä’∏÷Ç’¥’ù 20 ’¢’°’º/÷Ä’∏’∫’•
      </div>
    </div>
  </div>

  <script>
    const CORRECT_PASSWORD = "erebuni2024";
    const AUTH_KEY = 'productivity_auth';
    const DATA_URL = "https://dq7nxls5c5g6rsf7oyrsseivda0qfhnv.lambda-url.us-east-1.on.aws/";
    const CHARS_PER_HOUR_TYPED = 16 * 5 * 60; // 20 WPM ‚Üí 4800 chars/hour
    const DICTATION_SPEEDUP = 3;
    const STORAGE_KEY_TYPING = 'productivity_typing_data';
    const STORAGE_KEY_TIMESTAMP = 'productivity_data_timestamp';

    // === ’Å‘µ’ê ’ë‘±’Ü‘ø‘∏ ===
    const DICTATION_USERS = [
      { fullName: "Hamaspyur_Ctomography", dept: "CT", chars: 19121.24 },
      { fullName: "Karine_Ctomography", dept: "CT", chars: 18088.50 },
      { fullName: "Lusine_Ctomography", dept: "CT", chars: 11931.9 },
      { fullName: "Eva_Mrt", dept: "MRT", chars: 11263.67 },
      { fullName: "Zhanna_Mrt", dept: "MRT", chars: 12370.8 },
      { fullName: "Hayk_Ctomography", dept: "CT", chars: 4754.47 },
      { fullName: "Gayane_Ctomography", dept: "CT", chars: 9581.0 },
      { fullName: "Vigen_Ctomography", dept: "CT", chars: 6928.0 },
      { fullName: "Sveta_Mrt", dept: "MRT", chars: 3362.0 },
      { fullName: "Rima_Mrt", dept: "MRT", chars: 3428.0 },
      { fullName: "Eduard_Mrt", dept: "MRT", chars: 2138.5 },
      { fullName: "Margarita_Ctomography", dept: "CT", chars: 1906.00 },
      { fullName: "Mikhayil_Mrt", dept: "MRT", chars: 1250.0 },
      { fullName: "Susanna_Ctomography", dept: "CT", chars: 0.00 }
    ];

    let rawDataTyping = [];
    let departments = {};

    function handleLogin() {
      const pwd = document.getElementById('passwordInput').value.trim();
      if (pwd === CORRECT_PASSWORD) {
        localStorage.setItem(AUTH_KEY, 'true');
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('mainContent').classList.add('visible');
      } else {
        document.getElementById('loginError').classList.add('visible');
        document.getElementById('passwordInput').classList.add('error');
      }
    }

    function checkAuth() { return localStorage.getItem(AUTH_KEY) === 'true'; }

    function togglePasswordVisibility() {
      const input = document.getElementById('passwordInput');
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    function extractDepartment(hostname) {
      const lower = hostname.toLowerCase();
      const excluded = ['zhenya', 'pahest', 'oper', 'buleten', 'aphoteka', 'archiv', 'arxiv', 'premium', 'comfort', 'inform', 'opersroom', 'lawyer', 'statistic', 'radiology', 'tntes', 'manage', 'luso', 'windows'];
      if (excluded.some(e => lower.includes(e))) return null;
      if (lower.includes('ctomography')) return 'CT';
      if (lower.includes('mrt') || lower.includes('mrtdoc')) return 'MRT';
      const map = { 'cardio': 'Cardiology', 'vascular': 'Vascular', 'urology': 'Urology', 'lor': 'LOR' };
      for (const [k, v] of Object.entries(map)) if (lower.includes(k)) return v;
      return null;
    }

    async function loadData() {
      if (!checkAuth()) return;
      const loading = document.getElementById('loading');
      loading.style.display = 'block';
      try {
        const res = await fetch(DATA_URL + '?t=' + Date.now());
        const text = await res.text();
        rawDataTyping = text.trim().split('\n')
          .map(l => l.trim())
          .filter(l => l.includes('|'))
          .map(l => {
            const [host, avg] = l.split('|').map(s => s.trim());
            const hostname = host.split(' ')[0].toLowerCase();
            const chars = parseFloat(avg.match(/[\d,]+\.?\d*/)[0].replace(/,/g, ''));
            return { hostname, chars, original: host };
          });

        localStorage.setItem(STORAGE_KEY_TYPING, JSON.stringify(rawDataTyping));
        localStorage.setItem(STORAGE_KEY_TIMESTAMP, new Date().toISOString());

        processData();
        renderDictationDepartments();
        renderOtherDepartments();
        loading.style.display = 'none';
      } catch (err) {
        document.getElementById('error').textContent = '’ç’≠’°’¨: ' + err.message;
        document.getElementById('error').style.display = 'block';
        loading.style.display = 'none';
      }
    }

    function processData() {
      departments = { MRT: { users: [], total: 0, active: 0 }, CT: { users: [], total: 0, active: 0 }, others: {} };

      // Add dictation users
      DICTATION_USERS.forEach(u => {
        const dept = u.dept === 'CT' ? 'CT' : 'MRT';
        departments[dept].users.push({ ...u, isDictation: true, isActive: u.chars >= 1000 });
        if (u.chars >= 1000) {
          departments[dept].total += u.chars;
          departments[dept].active += 1;
        }
      });

      // Add others (non-MRT/CT)
      rawDataTyping.forEach(item => {
        const dept = extractDepartment(item.hostname);
        if (!dept || dept === 'MRT' || dept === 'CT') return;
        if (!departments.others[dept]) departments.others[dept] = { users: [], total: 0, active: 0 };
        item.isActive = item.chars >= 2000;
        departments.others[dept].users.push(item);
        if (item.isActive) {
          departments.others[dept].total += item.chars;
          departments.others[dept].active += 1;
        }
      });
    }

    function renderDictationDepartments() {
      const container = document.getElementById('dictationDepartments');
      container.innerHTML = '';

      ['MRT', 'CT'].forEach(deptKey => {
        const data = departments[deptKey];
        const hrsNow = data.total / CHARS_PER_HOUR_TYPED;
        const hrsWould = hrsNow * DICTATION_SPEEDUP;
        const saved = hrsWould - hrsNow;

        const card = document.createElement('div');
        card.className = 'dept-card dictation-dept';
        card.innerHTML = `
          <div class="dept-header" onclick="toggleUsers('dict-${deptKey}')">
            <div>
              <div class="dept-name">${deptKey} üé§</div>
              <div class="dept-metric" style="color:var(--success);">
                ${hrsNow.toFixed(1)} ’™/÷Ö÷Ä (’§’´’Ø’ø’°÷Å’´’°)
              </div>
              <div style="color:var(--trust-blue); font-weight:700;">
                ‘Ω’∂’°’µ’∏÷Ç’¥ ’ß ${saved.toFixed(1)} ’™/÷Ö÷Ä (3√ó ’°÷Ä’°’£)
              </div>
              <div class="dept-subtext">
                ${data.active} ’°’Ø’ø’´’æ ’¢’™’´’∑’Ø ‚Ä¢ ${data.total.toLocaleString()} ’∂’´’∑
              </div>
              <div class="savings-info">
                <div class="savings-header">
                  <span class="savings-icon">Fast</span>
                  <span class="savings-title">‘¥’´’Ø’ø’°÷Å’´’°’∂ 3√ó ’°÷Ä’°’£ ’ß</span>
                </div>
                <div class="savings-comparison">
                  <div class="comparison-item">
                    <div class="comparison-label">’Ä’´’¥’°</div>
                    <div class="comparison-value after">${hrsNow.toFixed(1)} ’™</div>
                  </div>
                  <div class="comparison-item">
                    <div class="comparison-label">’è’∫’°’£÷Ä’∏÷Ç’¥</div>
                    <div class="comparison-value before">${hrsWould.toFixed(1)} ’™</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="dept-toggle">Down Arrow</div>
          </div>
          <div id="users-dict-${deptKey}" class="users-container"></div>
        `;
        container.appendChild(card);
      });
    }

    function renderOtherDepartments() {
      const container = document.getElementById('otherDepartments');
      container.innerHTML = '<h2 style="color:#64748b; margin-top:3rem;">‘±’µ’¨ ’¢’°’™’´’∂’∂’•÷Ä (’ø’∫’°’£÷Ä’∏÷Ç’¥)</h2>';
      Object.entries(departments.others).forEach(([dept, data]) => {
        const hrs = data.total / CHARS_PER_HOUR_TYPED;
        const card = document.createElement('div');
        card.className = 'dept-card';
        card.innerHTML = `
          <div class="dept-header">
            <div>
              <div class="dept-name">${dept}</div>
              <div class="dept-metric" style="color:var(--danger);">
                ${hrs.toFixed(1)} ’Ø’∏÷Ä’°’Æ ’™/÷Ö÷Ä
              </div>
              <div class="dept-subtext">
                ${data.active} ’°’Ø’ø’´’æ ‚Ä¢ ${data.total.toLocaleString()} ’∂’´’∑
              </div>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    window.toggleUsers = function(id) {
      const el = document.getElementById(`users-${id}`);
      const open = el.classList.toggle('open');
      el.parentElement.querySelector('.dept-toggle').textContent = open ? 'Up Arrow' : 'Down Arrow';
      if (open && !el.dataset.rendered) {
        if (id.startsWith('dict-')) renderDictUsers(id.split('-')[1]);
        el.dataset.rendered = 'true';
      }
    };

    function renderDictUsers(deptKey) {
      const container = document.getElementById(`users-dict-${deptKey}`);
      const users = departments[deptKey].users.sort((a, b) => b.chars - a.chars);
      container.innerHTML = `<div class="user-list" id="list-${deptKey}"></div>`;
      const list = document.getElementById(`list-${deptKey}`);
      users.forEach(u => {
        const hrs = u.chars / CHARS_PER_HOUR_TYPED;
        const saved = hrs * (DICTATION_SPEEDUP - 1);
        const item = document.createElement('div');
        item.className = 'user-item';
        item.innerHTML = `
          <div class="user-name">${u.fullName} üé§</div>
          <div class="user-metric">
            ${u.chars.toLocaleString()} ’∂’´’∑ ‚Ä¢
            <span style="color:var(--success)">${hrs.toFixed(1)} ’™</span>
            <span class="user-savings">‚Üí ’≠’∂’°’µ’∏÷Ç’¥ ’ß ${saved.toFixed(1)} ’™</span>
          </div>
        `;
        list.appendChild(item);
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      if (checkAuth()) {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('mainContent').classList.add('visible');
      }
      loadData();
    });
  </script>
</body>
</html>
